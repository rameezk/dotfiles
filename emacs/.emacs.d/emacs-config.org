#+title: Emacs Config
#+PROPERTY: header-args:emacs-lisp :tangle ./init.el :mkdirp yes

* Performance
** Startup
#+begin_src emacs-lisp
;; The default is 800 kilobytes.  Measured in bytes.
(setq gc-cons-threshold (* 50 1000 1000))

;; Profile emacs startup
(add-hook 'emacs-startup-hook
          (lambda ()
            (message "*** Emacs loaded in %s with %d garbage collections."
                     (format "%.2f seconds"
                             (float-time
                              (time-subtract after-init-time before-init-time)))
                     gcs-done)))
#+end_src

* Networking
** Proxy
Check if the ~~/.proxyrc~ exists. If it does, we assume we need to have a proxy set.

Ideally, we should source this file, but for now, we just assume something like CNTLM
is running on "127.0.0.1:3128".

#+begin_src emacs-lisp
(if (file-exists-p "~/.proxyrc")
(setq url-proxy-services
         '(("no_proxy" . "^\\(localhost\\|10.*\\)")
                ("http" . "127.0.0.1:3128")
                     ("https" . "127.0.0.1:3128"))) nil)
#+end_src

* Package Management
#+begin_src emacs-lisp
;; Initialize package sources
(require 'package)

(setq package-archives '(("melpa" . "https://melpa.org/packages/")
                         ("melpa-stable" . "https://stable.melpa.org/packages/")
                         ("org" . "https://orgmode.org/elpa/")
                         ("elpa" . "https://elpa.gnu.org/packages/")))

;;(package-initialize)
;; (unless package-archive-contents
;;   (package-refresh-contents))

;; Initialize use-package on non-Linux platforms
(unless (package-installed-p 'use-package) 
   (package-install 'use-package))
(require 'use-package)

;; Uncomment this to get a reading on packages that get loaded at startup
(setq use-package-verbose t)

;; On non-Guix systems, "ensure" packages by default
(setq use-package-always-ensure t)
#+end_src

* Appearance
** Interface
*** Startup Message/Splash Screen
Me no likey, so will disable
#+begin_src emacs-lisp
(setq inhibit-startup-message t)
#+end_src

*** Menu Bar
Takes up unneccessary space, will disable.
#+begin_src emacs-lisp
(menu-bar-mode -1)
#+end_src

*** Tool Bar 
Disable fugly tool bar.
#+begin_src emacs-lisp
(tool-bar-mode -1)
#+end_src

*** Scrollbars
Make scrollbars invisible.
#+begin_src emacs-lisp
(scroll-bar-mode -1)
#+end_src
* Font
#+begin_src emacs-lisp
(set-face-attribute 'default nil :font "JetbrainsMono Nerd Font" :height 160)
#+end_src

* Theme
#+begin_src emacs-lisp
(load-theme 'wombat t)
#+end_src

* Org Mode
** Babel
*** Languages
In order to execute code in ~org-mode~ blocks, we need to define the following:
#+begin_src emacs-lisp
(org-babel-do-load-languages
  'org-babel-load-languages
  '((emacs-lisp . t)))

(push '("conf-unix" . conf-unix) org-src-lang-modes)
#+end_src

*** Auto-tangle Configuration Files
We define a function that gets executed every time this file is saved.
#+begin_src emacs-lisp
;; Since we don't want to disable org-confirm-babel-evaluate all
;; of the time, do it around the after-save-hook
(defun rkn/org-babel-tangle-dont-ask ()
  ;; Dynamic scoping to the rescue
  (let ((org-confirm-babel-evaluate nil))
    (org-babel-tangle)))

(add-hook 'org-mode-hook (lambda () (add-hook 'after-save-hook #'rkn/org-babel-tangle-dont-ask
                                              'run-at-end 'only-in-org-mode)))

#+end_src
